<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>Spark Games | PlayOffline Games, Action, Puzzle & Adventure</title>

  <meta name="description"
    content="PlayOffline games at Spark Games â€” your hub for action, puzzle, adventure, and arcade fun. No downloads required. Enjoy exciting new games daily!" />
  <meta name="keywords"
    content="spark games,Offline games, play games, action games, adventure games, puzzle games, arcade games, fun games, browser games, online gaming" />
  <meta name="author" content="Spark Games" />
  <meta name="robots" content="index, follow" />
  <meta name="language" content="en" />
  <meta name="theme-color" content="#0d1117" />

  <!-- Open Graph (for social media like Facebook, Discord, etc.) -->
  <meta property="og:title" content="Spark Games | Offline Games" />
  <meta property="og:description"
    content="Join Spark Games and play hundreds of fun, action, and puzzle games for free. No downloads, just play instantly!" />
  <meta property="og:image" content="https://www.sparkgames.shop/assets/favicon.svg" />
  <meta property="og:url" content="https://www.sparkgames.shop/" />
  <meta property="og:type" content="website" />

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Spark Games |Offline Gaming" />
  <meta name="twitter:description"
    content="Play online games instantly â€” action, adventure, puzzle & arcade games all in one place at Spark Games." />
  <meta name="twitter:image" content="https://www.sparkgames.shop/assets/favicon.svg" />

  <!-- Canonical URL -->
  <link rel="canonical" href="https://www.sparkgames.shop/" />

  <!-- Stylesheet -->
  <link rel="stylesheet" href="css/style.css" />

  <!-- Favicon -->
  <link rel="icon" href="assets/favicon.svg" type="image/svg+xml" />

  <style>
    /* Remove scrollbar from modal and add fullscreen image viewer */
    .modal-grid {
      overflow: hidden !important;
    }

    .modal-grid::-webkit-scrollbar {
      display: none;
    }

    /* Fullscreen image viewer */
    .fullscreen-viewer {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.95);
      z-index: 10000;
      align-items: center;
      justify-content: center;
    }

    .fullscreen-viewer.active {
      display: flex;
    }

    .fullscreen-viewer img {
      max-width: 90%;
      max-height: 90%;
      object-fit: contain;
    }

    .fullscreen-close {
      position: absolute;
      top: 20px;
      right: 20px;
      background: none;
      border: none;
      color: #e2e8f0;
      font-size: 32px;
      cursor: pointer;
      z-index: 10001;
    }

    .fullscreen-close:hover {
      color: #fff;
    }

    .m-img {
      cursor: pointer;
      transition: transform 0.2s;
    }

    .m-img:hover {
      transform: scale(1.05);
    }

    .fullscreen-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.95);
      z-index: 10000;
      align-items: center;
      justify-content: center;
    }

    .fullscreen-modal.active {
      display: flex;
    }

    .fullscreen-image {
      max-width: 90%;
      max-height: 90%;
      object-fit: contain;
    }
  </style>
</head>


<body>
  <div class="tape-overlay"></div>

  <div class="container">
    <header>
      <h1>
        <img class="brand-mark" alt="Gamepad"
          src="data:image/svg+xml;utf8,<?xml version='1.0' encoding='UTF-8'?><svg xmlns='http://www.w3.org/2000/svg' width='40' height='40' viewBox='0 0 24 24'><path fill='%2300d1ff' d='M5 7h14a3 3 0 0 1 3 3v2.5a3.5 3.5 0 0 1-6.42 1.72l-1.04-1.64H9.46l-1.04 1.64A3.5 3.5 0 0 1 2 12.5V10a3 3 0 0 1 3-3Z'/><path fill='%2300ff9c' d='M8 10H6v2H4v-2H2V8h2V6h2v2h2z'/><circle cx='18.5' cy='11' r='1' fill='%23e2e8f0'/><circle cx='16.5' cy='13' r='1' fill='%23e2e8f0'/></svg>" />
        Spark Games
      </h1>
      <p class="tagline">Your Ultimate Gaming Destination</p>
    </header>

    <div class="surface follow">
      <span class="label">Follow us</span>
      <a class="chip" href="https://www.youtube.com/@Hasnain-official-PCGAMER?sub_confirmation=1" target="_blank"
        rel="noopener">
        Daraz
      </a>
      <a class="chip" href="https://www.facebook.com/share/1QVrxic2EE/?mibextid=wwXIfr" target="_blank" rel="noopener">
        Facebook
      </a>
      <a class="chip" href="https://www.youtube.com/@Hasnain-official-PCGAMER?sub_confirmation=1" target="_blank"
        rel="noopener">
        YouTube
      </a>
    </div>

    <div class="search-wrap">
      <input id="searchInput" class="search-input" placeholder="Search for your favorite games..." />

      <img class="search-icon" alt="Search"
        src="data:image/svg+xml;utf8,<?xml version='1.0' encoding='UTF-8'?><svg xmlns='http://www.w3.org/2000/svg' width='22' height='22' viewBox='0 0 24 24'><path fill='%23e2e8f0' d='M15.5 14h-.79l-.28-.27a6.471 6.471 0 0 0 1.57-4.23 6.5 6.5 0 1 0-6.5 6.5 6.471 6.471 0 0 0 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5Zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14Z'/></svg>" />
    </div>

    <div class="categories" id="categories">
      <button class="cat-btn active" data-category="all">All Games</button>
      <button class="cat-btn" data-category="Action">Action</button>
      <button class="cat-btn" data-category="Adventure">Adventure</button>
      <button class="cat-btn" data-category="RPG">RPG</button>
      <button class="cat-btn" data-category="Sports">Sports</button>
      <button class="cat-btn" data-category="Racing">Racing</button>
      <button class="cat-btn" data-category="Strategy">Strategy</button>
      <button class="cat-btn" data-category="Fighting ">Fighting</button>
    </div>

    <div id="gamesGrid" class="grid"></div>
    <div id="pagination" class="pagination"></div>
  </div>

  <div id="gameModal" class="modal" aria-hidden="true">
    <div class="modal-card" role="dialog" aria-modal="true">
      <button id="modalClose" class="modal-close" aria-label="Close">
        <img alt="Close" width="18" height="18"
          src="data:image/svg+xml;utf8,<?xml version='1.0' encoding='UTF-8'?><svg xmlns='http://www.w3.org/2000/svg' width='18' height='18' viewBox='0 0 24 24'><path fill='%23e2e8f0' d='M18.3 5.71L12 12.01l-6.3-6.3-1.4 1.41 6.29 6.29-6.3 6.3 1.41 1.4 6.3-6.29 6.29 6.29 1.41-1.4-6.29-6.3 6.29-6.29z'/></svg>" />
      </button>

      <div id="modalImages" class="modal-grid"></div>

      <div class="modal-body">
        <h2 id="modalTitle" class="m-title"></h2>
        <div id="modalPrice" class="m-price"></div>

        <div class="m-sec">
          <h3>Description</h3>
          <p id="modalDescription"></p>
        </div>

        <div class="m-sec">
          <h3>System Requirements</h3>
          <div id="modalRequirements"></div>
        </div>
        <button id="buyBtn" class="buy-btn">Buy Now</button>
      </div>
    </div>
  </div>

  <!-- Added fullscreen image viewer modal -->
  <div id="fullscreenImageModal" class="fullscreen-modal" aria-hidden="true">
    <button id="fullscreenClose" class="fullscreen-close" aria-label="Close fullscreen">
      <img alt="Close" width="24" height="24"
        src="data:image/svg+xml;utf8,<?xml version='1.0' encoding='UTF-8'?><svg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24'><path fill='%23e2e8f0' d='M18.3 5.71L12 12.01l-6.3-6.3-1.4 1.41 6.29 6.29-6.3 6.3 1.41 1.4 6.3-6.29 6.29 6.29 1.41-1.4-6.29-6.3 6.29-6.29z'/></svg>" />
    </button>
    <img id="fullscreenImage" alt="Fullscreen view" class="fullscreen-image" />
  </div>

  <div class="logo-img-button">
    <img src="assets/images/logo.jpeg" alt="LOGO" />
  </div>
  <script>
    const API_URL =
      new URLSearchParams(location.search).get("api") ||
      "https://YOUR_API_BASE/games";

    // Keep same assets/classes
    const defaultCardImage = "assets/images/img.jpeg";

    const gamesPerPage = 16;

    let allGames = [];
    let currentPage = 1;
    let currentCategory = "all";
    let searchQuery = "";
    let selectedGame = null;

    function logEvent() {
      /* no-op */
    }

    const starImg =
      "<img alt=\"*\" width=\"16\" height=\"16\" style=\"vertical-align:-2px\" src=\"data:image/svg+xml;utf8,<?xml version='1.0' encoding='UTF-8'?><svg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24'><path fill='%23fbbf24' d='M12 .587l3.668 7.431 8.2 1.193-5.934 5.785 1.402 8.164L12 18.896l-7.336 3.864 1.402-8.164L.132 9.211l8.2-1.193z'/></svg>\">";

    function stars(r) {
      const rating = Number(r);
      if (!Number.isFinite(rating)) return "";
      const n = Math.floor(Math.max(0, Math.min(5, rating)));
      return (
        starImg.repeat(n) +
        ' <span style="opacity:.9">' +
        rating.toFixed(1) +
        "</span>"
      );
    }

    function normalizeGame(raw) {
      // Map API fields to UI-friendly structure; keep classes/markup unchanged
      const priceText =
        typeof raw.price === "number"
          ? "PKR " + raw.price.toLocaleString("en-PK")
          : raw.price ?? "PKR â€”";

      const reqList = Array.isArray(raw.requirements)
        ? raw.requirements
        : typeof raw.systemRequirements === "string"
          ? raw.systemRequirements
            .split(/\n|,|;|\r/)
            .map((s) => s.trim())
            .filter(Boolean)
          : [];

      const thumbs = [];
      if (raw.screenshots && Array.isArray(raw.screenshots))
        thumbs.push(...raw.screenshots.filter(Boolean));
      if (raw.screenshot) thumbs.push(raw.screenshot);
      if (raw.thumbnail) thumbs.push(raw.thumbnail);

      return {
        id: raw._id || raw.id || crypto.randomUUID?.() || String(Math.random()),
        name: raw.name || raw.title || "Untitled",
        category: raw.category || "Action",
        price: priceText,
        rating: raw.rating,
        description: raw.description || "",
        requirements: reqList,
        thumbnail: raw.thumbnail || raw.image || defaultCardImage,
        gallery: thumbs.length ? thumbs : [defaultCardImage],
        createdAt: raw.createdAt || raw.uploadDate || raw.date || null,
        // Store individual screenshot fields
        screenshot1: raw.screenshot1 || null,
        screenshot2: raw.screenshot2 || null,
        screenshot3: raw.screenshot3 || null,
        screenshot4: raw.screenshot4 || null,
        systemRequirements: raw.systemRequirements || ""
      };
    }

    async function fetchGames() {
      try {
        const res = await fetch(
          `https://spark-games-backend.vercel.app/api/get-all`,
          {
            headers: { Accept: "application/json" },
          }
        );
        if (!res.ok) throw new Error("Failed to fetch: " + res.status);
        const data = await res.json();

        // Accept both array or { games: [...] } shapes
        const list = Array.isArray(data)
          ? data
          : Array.isArray(data?.games)
            ? data.games
            : [];
        allGames = list.map(normalizeGame);

        console.log("Fetched games:", allGames);
      } catch (err) {
        console.error("[v0] API error:", err);
        allGames = [];
      }
    }

    function nervestFilter() {
      allGames.sort((a, b) => {
        const dateA = new Date(a.createdAt || 0);
        const dateB = new Date(b.createdAt || 0);
        return dateB - dateA; // newest â†’ oldest
      });
      logEvent("Games filtered by newest uploads");
    }

    function filterGames() {
      let filtered = allGames;
      if (currentCategory !== "all") {
        filtered = filtered.filter(
          (g) =>
            String(g.category).toLowerCase() ===
            String(currentCategory).toLowerCase()
        );
      }
      if (searchQuery) {
        const q = searchQuery.toLowerCase();
        filtered = filtered.filter(
          (g) =>
            g.name.toLowerCase().includes(q) ||
            String(g.category).toLowerCase().includes(q)
        );
      }
      return filtered;
    }

    function render() {
      const filtered = filterGames();
      const grid = document.getElementById("gamesGrid");
      const pag = document.getElementById("pagination");
      grid.innerHTML = "";

      if (filtered.length === 0) {
        pag.style.display = "none";
        const empty = document.createElement("div");
        empty.className = "empty";
        empty.textContent = "Game not found";
        grid.appendChild(empty);
        return;
      } else {
        pag.style.display = "";
      }

      const totalPages = Math.ceil(filtered.length / gamesPerPage) || 1;
      currentPage = Math.min(currentPage, totalPages);
      const startIndex = (currentPage - 1) * gamesPerPage;
      const items = filtered.slice(startIndex, startIndex + gamesPerPage);

      items.forEach((game) => {
        const el = document.createElement("div");
        el.className = "card";
        const badgeClass =
          {
            action: "b-action",
            adventure: "b-adventure",
            rpg: "b-rpg",
            sports: "b-sports",
            racing: "b-racing",
            strategy: "b-strategy",
          }[String(game.category).toLowerCase()] || "b-action";

        const ratingHtml = stars(game.rating);
        el.innerHTML = `
          <img class="card-img" alt="${game.name}" src="${game.thumbnail || defaultCardImage
          }">
          <span class="badge ${badgeClass}">${game.category}</span>
          <div class="card-body">
            <div class="title">${game.name}</div>
            <div class="price">${game.price}</div>
            <div class="rating">${ratingHtml}</div>
          </div>
        `;
        el.addEventListener("click", () => openModal(game));
        grid.appendChild(el);
      });

      // Pagination
      pag.innerHTML = "";
      const prev = document.createElement("button");
      prev.className = "page-btn";
      prev.textContent = "â† Previous";
      prev.disabled = currentPage === 1;
      prev.onclick = () => {
        if (currentPage > 1) {
          currentPage--;
          render();
          logEvent("Page changed: " + currentPage);
          window.scrollTo({ top: 0, behavior: "smooth" });
        }
      };
      pag.appendChild(prev);

      const totalPagesToShow = Math.ceil(filtered.length / gamesPerPage);
      const start = Math.max(1, currentPage - 2);
      const end = Math.min(totalPagesToShow, currentPage + 2);
      for (let i = start; i <= end; i++) {
        const b = document.createElement("button");
        b.className = "page-btn" + (i === currentPage ? " active" : "");
        b.textContent = i;
        b.onclick = () => {
          currentPage = i;
          render();
          logEvent("Page changed: " + currentPage);
          window.scrollTo({ top: 0, behavior: "smooth" });
        };
        pag.appendChild(b);
      }

      const next = document.createElement("button");
      next.className = "page-btn";
      next.textContent = "Next â†’";
      next.disabled = currentPage === totalPagesToShow;
      next.onclick = () => {
        if (currentPage < totalPagesToShow) {
          currentPage++;
          render();
          logEvent("Page changed: " + currentPage);
          window.scrollTo({ top: 0, behavior: "smooth" });
        }
      };
      pag.appendChild(next);
    }

      function openModal(game) {
        selectedGame = game;
        console.log("Selected game:", selectedGame);

        const modalImages = document.getElementById("modalImages");
        const title = document.getElementById("modalTitle");
        const price = document.getElementById("modalPrice");
        const desc = document.getElementById("modalDescription");
        const reqDiv = document.getElementById("modalRequirements");

        // Clear old images
        modalImages.innerHTML = "";

        // âœ… Collect 4 screenshots directly
        const screenshots = [
          game.screenshot1,
          game.screenshot2,
          game.screenshot3,
          game.screenshot4
        ];

        console.log("Screenshots before filter:", screenshots);

        // âœ… Filter only valid non-empty strings
        const validScreenshots = screenshots.filter(src => typeof src === "string" && src.trim() !== "");

        console.log("Valid screenshots:", validScreenshots);

        // âœ… Display screenshots
        if (validScreenshots.length > 0) {
          validScreenshots.forEach((src, i) => {
            console.log(i);
            
            const img = document.createElement("img");
            img.className = "m-img";
            img.alt = `${game.name} Screenshot ${i + 1}`;
            img.src = src;
            console.log(src);
            
            img.style.cursor = "pointer";

            // Handle broken links gracefully
            img.onerror = function () {
              console.warn("Failed to load image:", src);
              this.style.display = "none";
            };

            // Click to fullscreen
            img.addEventListener("click", () => openFullscreenImage(src));

            // Append to modal
            modalImages.appendChild(img);
          });
        } else {
          // If no images found
          const noImg = document.createElement("p");
          noImg.textContent = "No screenshots available.";
          noImg.style.padding = "20px";
          noImg.style.textAlign = "center";
          noImg.style.color = "#888";
          modalImages.appendChild(noImg);
        }

        // âœ… Game details
        title.textContent = game.name || "Untitled Game";
        price.textContent = game.price ? `$${game.price}` : "Free";
        desc.textContent = game.description || "No description available.";
        reqDiv.textContent = game.systemRequirements || "No system requirements specified.";

        // âœ… Show modal
        const modal = document.getElementById("gameModal");
        modal.classList.add("active");
        document.body.style.overflow = "hidden";
        modal.setAttribute("aria-hidden", "false");

        logEvent("Opened: " + game.name);
      }


    function closeModal() {
      const modal = document.getElementById("gameModal");
      modal.classList.remove("active");
      document.body.style.overflow = "";
      modal.setAttribute("aria-hidden", "true");
      logEvent("Modal closed");
    }

    function openFullscreenImage(src) {
      const fullscreenModal = document.getElementById("fullscreenImageModal");
      const fullscreenImage = document.getElementById("fullscreenImage");
      fullscreenImage.src = src;
      fullscreenModal.classList.add("active");
      document.body.style.overflow = "hidden";
      fullscreenModal.setAttribute("aria-hidden", "false");
    }

    function closeFullscreenImage() {
      const fullscreenModal = document.getElementById("fullscreenImageModal");
      fullscreenModal.classList.remove("active");
      document.body.style.overflow = "";
      fullscreenModal.setAttribute("aria-hidden", "true");
    }

    // Wire up events
    document.addEventListener("DOMContentLoaded", async () => {
      document.getElementById("modalClose").addEventListener("click", closeModal);
      document.getElementById("gameModal").addEventListener("click", (e) => {
        if (e.target && e.target.id === "gameModal") closeModal();
      });

      document.getElementById("fullscreenClose").addEventListener("click", closeFullscreenImage);
      document.getElementById("fullscreenImageModal").addEventListener("click", (e) => {
        if (e.target && e.target.id === "fullscreenImageModal") closeFullscreenImage();
      });

      document.getElementById("buyBtn").addEventListener("click", () => {
        if (selectedGame) {
          const message = "I want to buy this game: " + selectedGame.name;
          const whatsappUrl =
            "https://wa.me/923156263180?text=" + encodeURIComponent(message);
          window.open(whatsappUrl, "_blank");
          logEvent("Buy click: " + selectedGame.name);
        }
      });

      document.getElementById("searchInput").addEventListener("input", (e) => {
        searchQuery = e.target.value;
        currentPage = 1;
        render();
        logEvent('Search: "' + searchQuery + '"');
      });

      document.querySelectorAll("#categories .cat-btn").forEach((btn) => {
        btn.addEventListener("click", () => {
          document
            .querySelectorAll("#categories .cat-btn")
            .forEach((b) => b.classList.remove("active"));
          btn.classList.add("active");
          currentCategory = btn.dataset.category;
          currentPage = 1;
          render();
          logEvent("Category: " + currentCategory);
        });
      });

      // ðŸ§© Fetch games, sort by newest, then render
      await fetchGames();
      nervestFilter();
      render();
    });

  </script>
</body>

</html>